{% extends "base.html" %}
{% block title %}Conversation with {{ partner.name }}{% endblock %}

{% block content %}
<div class="conversation-wrapper">
  <div class="conversation-header-bar">
    <a href="{{ url_for('messages') }}" class="back-link">â† Back to Messages</a>
    <div class="conversation-partner">
      <div class="conversation-avatar-small">{{ partner.name[0].upper() }}</div>
      <div>
        <strong>{{ partner.name }}</strong>
        <a href="{{ url_for('profile', user_id=partner.id) }}" class="link">View Profile</a>
      </div>
    </div>
  </div>

  <div class="messages-container">
    {% for message in messages %}
      <div class="message {% if message.sender_id == user.id %}message-sent{% else %}message-received{% endif %}">
        <div class="message-content">
          {{ message.content|nl2br }}
        </div>
        <div class="message-time">
          {{ message.created_at.strftime('%b %d, %Y %I:%M %p') if message.created_at else 'Recently' }}
        </div>
      </div>
    {% endfor %}
  </div>

  <form method="post" class="message-form">
    {% if request.args.get('task_id') %}
      <input type="hidden" name="task_id" value="{{ request.args.get('task_id') }}">
    {% endif %}
    <div class="message-input-wrapper">
      <textarea name="content" rows="3" placeholder="Type your message..." required></textarea>
      <button type="submit" class="btn-primary">Send</button>
    </div>
  </form>
</div>
{% endblock %}


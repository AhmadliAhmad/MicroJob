{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h1>My Dashboard</h1>

<div class="dashboard-stats">
  <div class="stat-card">
    <div class="stat-number">{{ tasks|length }}</div>
    <div class="stat-label">Total Jobs Posted</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ tasks|selectattr('status', 'equalto', 'open')|list|length }}</div>
    <div class="stat-label">Open Jobs</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ tasks|selectattr('status', 'equalto', 'assigned')|list|length }}</div>
    <div class="stat-label">In Progress</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ tasks|selectattr('status', 'equalto', 'completed')|list|length }}</div>
    <div class="stat-label">Completed</div>
  </div>
</div>

<div class="dashboard-section">
  <div class="section-header">
    <h2>My Jobs</h2>
    <a href="{{ url_for('new_task') }}" class="btn-primary">Post New Job</a>
  </div>

  {% if tasks %}
    <div class="task-list">
      {% for task in tasks %}
        <div class="task-card">
          <div class="task-main">
            <h3><a href="{{ url_for('task_detail', task_id=task.id) }}">{{ task.title }}</a></h3>
            <p class="task-desc">{{ task.description[:100] }}{% if task.description|length > 100 %}...{% endif %}</p>
            <div class="task-meta">
              <span>{{ task.category or 'General' }}</span>
              <span>{{ task.mode|title }}</span>
              <span class="status-{{ task.status }}">{{ task.status|title }}</span>
            </div>
          </div>
          <div class="task-side">
            <div class="task-budget">{{ task.budget_azn }} AZN</div>
            <div class="task-bids-count">
              {{ task.bids|length }} bid{{ 's' if task.bids|length != 1 else '' }}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <p>You haven't posted any jobs yet. <a href="{{ url_for('new_task') }}" class="link">Post your first job!</a></p>
    </div>
  {% endif %}
</div>
{% endblock %}

